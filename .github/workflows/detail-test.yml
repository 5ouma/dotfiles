name: ğŸ”¬ Detail Test

on:
  schedule:
    - cron: 0 0 1 * *
  workflow_dispatch:

permissions: {}

jobs:
  test:
    name: ${{ startsWith(matrix.os, 'macOS') && 'ğŸ' || 'ğŸ§' }} ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    timeout-minutes: 20
    strategy:
      fail-fast: false
      matrix:
        os: [Ubuntu-Latest, macOS-Latest]

    steps:
      - name: ğŸ§° Install dependencies
        if: ${{ matrix.os == 'Ubuntu-Latest' }}
        run: |
          sudo apt-get install -y build-essential procps curl file git zsh
          sudo snap install --classic code

      - name: âš™ï¸ Run setup
        run: zsh <(curl "https://dot.5ouma.me/${GITHUB_HEAD_REF:-HEAD}") --yes
        env:
          SETUP_SKIP_LOGINGITHUBCLI: true
          SETUP_SKIP_RESTOREAPPSETTINGS: true
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸš Launch new login shell
        run: exec zsh -ilexc exit
