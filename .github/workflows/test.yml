name: üß™ Test

on:
  push:
    branches:
      - main
    paths:
      - setup
      - .github/workflows/test.yml
  pull_request:
    paths:
      - setup
      - .github/workflows/test.yml

jobs:
  test:
    name: ${{ startsWith(matrix.os, 'macOS') && 'üçé' || 'üêß' }} ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [Ubuntu-Latest, macOS-14]
    runs-on: ${{ matrix.os }}

    steps:
      - name: üç∫ Setup Homebrew
        uses: Homebrew/actions/setup-homebrew@a13eda877cb779461da1de25f0991398d655b35c # master

      - name: üî® Install tools via Homebrew
        run: |
          rm -fv /Library/Frameworks/Python.framework/Versions/3.12/bin/{2to3-3.12,idle3.12,pydoc3.12,python3.12,python3.12-config}
          brew install atuin gitlint mackup mise pre-commit sheldon vim zoxide zsh

      - name: üçé Install macOS tools via Homebrew
        if: ${{ matrix.os == 'macOS-14' }}
        run: brew install 5ouma/formula/mksei 5ouma/formula/mli blacktop/tap/lporg lslqtz/formulae/bclm_loop

      - name: ‚öôÔ∏è Run setup
        env:
          SETUP_SKIP_INSTALLAPPS: true
          SETUP_SKIP_LOGINGITHUBCLI: true
          SETUP_SKIP_RESTORELAUNCHPAD: true
        run: zsh <(curl "https://dotup.deno.dev/${GITHUB_HEAD_REF:-HEAD}") --yes

      - name: üêö Launch New Login Shell
        run: exec zsh -ilexc exit
